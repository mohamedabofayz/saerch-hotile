<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>إضافة فندق أو شركة تشغيل</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-6 font-sans">
  <div class="max-w-2xl mx-auto bg-white p-6 rounded shadow">
    <h2 class="text-xl font-semibold mb-4">إضافة بيانات</h2>

    <div class="space-y-3">
      <div>
        <label class="block text-sm">اسم الفندق</label>
        <input id="hotelName" class="w-full p-2 border rounded" placeholder="مثال: فندق الضيافة"/>
        <button onclick="addHotel()" class="mt-2 px-4 py-2 bg-blue-600 text-white rounded">إضافة الفندق</button>
      </div>

      <hr>

      <div>
        <label class="block text-sm">اسم شركة التشغيل</label>
        <input id="opName" class="w-full p-2 border rounded" placeholder="مثال: شركة النور"/>
        <label class="block text-sm mt-2">البريد الإلكتروني (افصل بفواصل)</label>
        <input id="opEmails" class="w-full p-2 border rounded" placeholder="a@x.com, b@y.com"/>
        <label class="block text-sm mt-2">أرقام واتساب (افصل بفواصل)</label>
        <input id="opWhats" class="w-full p-2 border rounded" placeholder="9665..., 9665..."/>
        <button onclick="addOperator()" class="mt-2 px-4 py-2 bg-green-600 text-white rounded">إضافة الشركة</button>
      </div>

      <hr>

      <div>
        <label class="block text-sm">ربط بين فندق ومعرّف شركة تشغيل</label>
        <input id="linkHotel" class="w-full p-2 border rounded" placeholder="HotelID (مثلا H...)" />
        <input id="linkOp" class="w-full p-2 border rounded mt-2" placeholder="OperatorID (مثلا O...)" />
        <button onclick="linkIDs()" class="mt-2 px-4 py-2 bg-indigo-600 text-white rounded">ربط</button>
      </div>

      <pre id="out" class="p-3 bg-gray-100 rounded text-sm"></pre>
    </div>
  </div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbx1KTtXXjV8s5s26fAmrF2MVqnaVUbsmApVbacMeXvLGVcrfZ6pdVqAxnUbzCpqPNrCug/exec";
const API_KEY = "123";

const out = document.getElementById("out");

async function addHotel(){
  const name = document.getElementById("hotelName").value.trim();
  if (!name) return (out.textContent = "أدخل اسم الفندق");
  const url = `${API_URL}?action=addHotel&name=${encodeURIComponent(name)}&key=${encodeURIComponent(API_KEY)}`;
  const res = await jsonpFetch(url);
  out.textContent = JSON.stringify(res, null, 2);
}

async function addOperator(){
  const name = document.getElementById("opName").value.trim();
  const emails = document.getElementById("opEmails").value.trim();
  const whats = document.getElementById("opWhats").value.trim();
  if (!name) return out.textContent = "أدخل اسم الشركة";
  const url = `${API_URL}?action=addOperator&name=${encodeURIComponent(name)}&emails=${encodeURIComponent(emails)}&whatsapps=${encodeURIComponent(whats)}&key=${encodeURIComponent(API_KEY)}`;
  const res = await jsonpFetch(url);
  out.textContent = JSON.stringify(res, null, 2);
}

async function linkIDs(){
  const h = document.getElementById("linkHotel").value.trim();
  const o = document.getElementById("linkOp").value.trim();
  if (!h || !o) return out.textContent = "أدخل كلا المعرفين";
  const url = `${API_URL}?action=link&hotelID=${encodeURIComponent(h)}&operatorID=${encodeURIComponent(o)}&key=${encodeURIComponent(API_KEY)}`;
  const res = await jsonpFetch(url);
  out.textContent = JSON.stringify(res, null, 2);
}

// JSONP helper
function jsonpFetch(url){
  return new Promise((resolve, reject) => {
    const cb = "cb_" + Math.random().toString(36).substr(2,9);
    window[cb] = data => { resolve(data); delete window[cb]; script.remove(); };
    const script = document.createElement("script");
    script.src = url + (url.indexOf("?") === -1 ? "?" : "&") + "callback=" + cb;
    script.onerror = () => { reject(new Error("Network error")); delete window[cb]; script.remove(); };
    document.body.appendChild(script);
  });
}
</script>
</body>
</html>
